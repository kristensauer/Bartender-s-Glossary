---
import TwoColumns from "@components/TwoColumns.astro"
---


<h2 id="tools" class="tools-section-title">Tools</h2>
<div class="tools-horizontal-scroll-container">
    <div class="tools-horizontal-scroll">
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Shaker</h3>
                        <p>A tin or glass used to mix cocktails with ice.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/shaker.jpg" alt="Shaker" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Strainer</h3>
                        <p>Filters ice, fruit, and herbs when pouring a drink.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/strainer.jpg" alt="Strainer" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Muddler</h3>
                        <p>A pestle-like tool for crushing fruits, herbs, or sugar.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/muddler.jpg" alt="Muddler" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Juicer/Press</h3>
                        <p>Extracts fresh juice from lemons, limes, or oranges.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/juicer.jpg" alt="Juicer" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Tongs</h3>
                        <p>For safely grabbing fruit for cocktails.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/tongs.jpg" alt="Tongs" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Mixing Glass</h3>
                        <p>A sturdy glass for stirred drinks like martinis or negronis.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/mixingglass.jpg" alt="Mixing Glass" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Jigger</h3>
                        <p>A double-sided measuring tool for accurate pours.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/jigger.jpg" alt="Jigger" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Bar Spoon</h3>
                        <p>Long-handled spoon for stirring and layering drinks.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/barspoon.jpg" alt="Bar-Spoon" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Ice Scoop</h3>
                        <p>For handling ice cleanly and safely.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/scooper.jpg" alt="Ice Scoop" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Bar Key</h3>
                        <p>For opening beer bottles.</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/barkey.jpg" alt="Bar Key" />
                    </div>
                </div>
            </div>
            <div class="content-box tools-content-box-control">
                <div class="content-details">
                    <div class="content-info">
                        <h3>Corkscrew</h3>
                        <p>For opening wine bottles</p>
                    </div>
                    <div class="content-image">
                        <img src="/images/corkscrew.jpg" alt="Corkscrew" />
                    </div>
                </div>
            </div>
    </div>
</div>
                        <div class="tools-scroll-controls" role="group" aria-label="Scroll tools">
                            <button id="toolsLeftBtn" type="button" class="tools-scroll-btn" aria-label="Scroll left">‹</button>
                            <button id="toolsRightBtn" type="button" class="tools-scroll-btn" aria-label="Scroll right">›</button>
                        </div>
                    <style>
                        .tools-section-title {
                            font-family: var(--font-heading);
                            font-size: 8rem;
                            color: var(--color-text);
                            text-align: center;
                            margin: 2rem 0 1rem 0;
                            letter-spacing: 0.05em;
                        }
                        :root {
                            --tool-box-w: 360px;
                            --tool-gap: 3rem;  
                        }
                        .tools-horizontal-scroll-container {
                            width: calc((var(--tool-box-w) * 2) + var(--tool-gap));
                            max-width: 90vw;
                            margin: 0 auto;
                                overflow-x: auto;
                                overflow-y: visible;
                            padding: 1rem 0;
                            box-sizing: border-box;
                        }
                        .tools-horizontal-scroll {
                            display: flex;
                            flex-direction: row;
                            gap: var(--tool-gap);
                            width: max-content;
                            align-items: stretch;
                            scroll-snap-type: x mandatory;
                            padding-bottom: 2rem;
                        }
                        .tools-horizontal-scroll .content-box {
                            scroll-snap-align: center;
                            min-width: var(--tool-box-w);
                            max-width: var(--tool-box-w);
                            padding: 7.0rem 1.5rem 1.5rem 1.5rem;
                            box-sizing: border-box;
                            text-align: center;
                        }
                        .tools-horizontal-scroll .content-box {
                            position: relative;
                            overflow: visible;
                        }
                        .tools-horizontal-scroll .content-image {
                            position: absolute;
                            top: -40px;
                            left: 50%;
                            transform: translateX(-50%);
                            width: 150px;
                            height: 150px;
                            border-radius: 50%;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            overflow: hidden;
                            z-index: 9999;
                        }
                        .tools-horizontal-scroll .content-image img {
                            width: 100%;
                            height: 100%;
                            object-fit: cover;
                            object-position: center;
                            display: block;
                            border-radius: 50%;
                        }
                        .tools-scroll-controls {
                            display: flex;
                            justify-content: center;
                            gap: 1rem;
                            margin-top: 1.5rem;
                            position: relative;
                            z-index: 1200; /* ensure controls are above overlapping elements */
                            pointer-events: auto !important;
                        }
                        .tools-scroll-btn {
                            background: var(--color-secondary);
                            color: var(--color-on-accent);
                            border: none;
                            padding: 0.8rem 1.4rem;
                            font-size: 2.6rem;
                            line-height: 1;
                            border-radius: 10px;
                            cursor: pointer;
                            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                            transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease;
                            pointer-events: auto;
                            touch-action: manipulation;
                        }
                        .tools-scroll-btn:active {
                            transform: translateY(1px);
                            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
                        }
                        @media (max-width: 700px) {
                            .tools-scroll-btn { 
                                font-size: 1.5rem; 
                                padding: 0.4rem 0.8rem; }
                        }
                        .tools-scroll-btn[disabled] {
                            opacity: 0.45;
                            cursor: default;
                            transform: none;
                            box-shadow: none;
                        }
                    </style>

                    <script type="module">
                        (function(){
                            const viewport = document.querySelector('.tools-horizontal-scroll-container');
                            if (!viewport) return;
                            const track = viewport.querySelector('.tools-horizontal-scroll');
                            const leftBtn = document.getElementById('toolsLeftBtn');
                            const rightBtn = document.getElementById('toolsRightBtn');
                            if (!track || !leftBtn || !rightBtn) return;

                            // debug init
                            try { console.debug('tools:init', { viewportClientW: viewport.clientWidth, viewportScrollW: viewport.scrollWidth }); } catch(e){}

                            function getScrollAmount(){
                                const item = track.querySelector('.content-box');
                                if (!item) return Math.max(viewport.clientWidth, 300);
                                const itemWidth = item.getBoundingClientRect().width;
                                const style = getComputedStyle(track);
                                const gapStr = style.gap || style.columnGap || '0px';
                                const gap = parseFloat(gapStr) || 0;
                                return Math.round(itemWidth + gap);
                            }

                            function updateButtons(){
                                const maxScroll = Math.max(0, viewport.scrollWidth - viewport.clientWidth);
                                const threshold = 6; // pixels of slack to avoid false positives on tiny overflows
                                const hasScroll = maxScroll > threshold;
                                // debug
                                try { console.debug('tools:updateButtons', { maxScroll, scrollLeft: viewport.scrollLeft, hasScroll }); } catch(e){}
                                // If there isn't meaningful scrollable area, keep buttons enabled so clicks still attempt to scroll
                                leftBtn.disabled = hasScroll ? (viewport.scrollLeft <= threshold) : false;
                                rightBtn.disabled = hasScroll ? (viewport.scrollLeft >= (maxScroll - threshold)) : false;
                            }

                            // Attach both click and pointerdown for better responsiveness on touch devices
                            function doScroll(delta){
                                const amt = getScrollAmount();
                                const scrollTarget = delta * amt;
                                // debug
                                try { console.debug('tools: scroll by', scrollTarget); } catch(e){}
                                if (typeof viewport.scrollBy === 'function') {
                                    viewport.scrollBy({ left: scrollTarget, behavior: 'smooth' });
                                } else {
                                    // fallback
                                    viewport.scrollLeft = Math.max(0, Math.min(viewport.scrollWidth - viewport.clientWidth, viewport.scrollLeft + scrollTarget));
                                }
                            }

                            // Attach listeners with capture so we get them early in the event chain
                            leftBtn.addEventListener('click', function leftHandler(e){
                                try { console.debug('tools:left click', e.target); } catch(e){}
                                const r = leftBtn.getBoundingClientRect();
                                try { console.debug('elementFromPoint at left center', document.elementFromPoint(r.left + r.width/2, r.top + r.height/2)); } catch(e){}
                                doScroll(-1);
                            }, { capture: true });
                            rightBtn.addEventListener('click', function rightHandler(e){
                                try { console.debug('tools:right click', e.target); } catch(e){}
                                const r = rightBtn.getBoundingClientRect();
                                try { console.debug('elementFromPoint at right center', document.elementFromPoint(r.left + r.width/2, r.top + r.height/2)); } catch(e){}
                                doScroll(1);
                            }, { capture: true });

                            // pointerdown fallback for touch
                            leftBtn.addEventListener('pointerdown', ()=> doScroll(-1), { passive: true });
                            rightBtn.addEventListener('pointerdown', ()=> doScroll(1), { passive: true });

                            // keep delegated as a last resort
                            document.addEventListener('click', function delegated(e){
                                const target = e.target;
                                if (!target) return;
                                if (target.id === 'toolsLeftBtn') { doScroll(-1); }
                                if (target.id === 'toolsRightBtn') { doScroll(1); }
                            });

                            viewport.addEventListener('scroll', updateButtons, { passive: true });
                            window.addEventListener('resize', updateButtons);
                            // ensure initial state after layout
                            setTimeout(updateButtons, 150);
                        })();
                    </script>
